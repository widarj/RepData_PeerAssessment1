---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

## Install libraries

```{r results="hide"}
install.packages("dplyr")
install.packages("ggplot2")
library(dplyr)
library(ggplot2)
```

## Loading and preprocessing the data
```{r}
unzip("activity.zip")
act <- read.csv("activity.csv")
dfAct <- as.data.frame.matrix(act)
```

## What is mean total number of steps taken per day?

```{r}
daily_sum_steps <- dfAct %>%
  mutate(day = as.Date(date, format="%Y-%m-%d")) %>%
  group_by(day) %>% # group by the day column
  summarise(total_steps=sum(steps)) #%>%  # calculate the SUM of all precipitation that occurred on each day
  #na.omit()

hist(daily_sum_steps$total_steps, breaks=10)

#{hist(daily_sum_steps$total_steps, breaks=10)
##abline(v = mx, col = "blue", lwd = 2)
#abline(v=meansteps,col="blue")
#abline(v=mediansteps,col="red")
#}

#barplot(daily_sum_steps$total_steps, names.arg=daily_sum_steps$date)
```
The mean and the medium of the total number of steps taken per day:

```{r}
mean(daily_sum_steps$total_steps)

median(daily_sum_steps$total_steps)

```



## What is the average daily activity pattern?
```{r}
mean_y <- mean(dfAct$steps, na.rm = TRUE)
dfAct$grp.mean.values <- ave(dfAct$steps, dfAct$interval, FUN=function(x) mean(x, na.rm=T))
max_x <- dfAct$interval[which.max(dfAct$grp.mean.values)]

ggplot(data = dfAct, aes(x = interval, y = steps)) + 
  stat_summary(fun.y = mean, na.rm = TRUE, geom ='line') +
  geom_hline(yintercept=mean_y, color = "red") +
  geom_vline(xintercept=max_x, color="red") +
  geom_text(aes(0,mean_y,label = round(mean_y,2), vjust = -1)) +
  geom_text(aes(max_x,0,label = round(max_x,2)))


#dfActNoNA$x <- gsub("-", "", dfActNoNA$date, fixed = FALSE)
#dfActNoNA$x <- paste(dfActNoNA$x,dfActNoNA$interval)
#dfActNoNA$x <- gsub(" ", "", dfActNoNA$x, fixed = FALSE)

#ts <- ts(dfActNoNA$x)

#dfActMeans <- dfActNoNA %>%
#   group_by(dfActNoNA$interval) %>%
#   summarise(yy=mean(dfActNoNA$steps))



#  geom_smooth(method = lm, se = FALSE)
  
#  geom_line(aes(y=steps), stat="summary", fun.y=mean)


#plot(ts, dfActNoNA$steps, type='l', xlab= 'Date', ylab= 'Steps', col='green' , lwd=1)

#dfActNoNA$dateFormatted <- as.Date(paste(dfActNoNA$date,dfActNoNA$interval)) #,"%Y%m%d %")
#dfActNoNA$x <- paste(dfActNoNA$date,dfActNoNA$interval)
#dfActNoNA$x <- gsub(" ", "", dfActNoNA$x, fixed = FALSE)

#plot(dfActNoNA$x[1:10], dfActNoNA$steps[1:10], type='l', xlab= 'Date', ylab= 'Steps', col='green' , lwd=2)

#ts <- ts(dfActNoNA$x) #, start=201210010, end=201211302355, frequency=12)

#plot(ts,
#       main="Test",
#       xlab="Year", ylab="Stock Price in INR",
#       col="navy")
```
The total number of missing values in the dataset are:

## Imputing missing values
```{r}
sum(is.na(dfAct$steps))


```

```{r}

dfActNoNA <- dfAct
dfActNoNA$steps[is.na(dfActNoNA$steps)] <- dfActNoNA$grp.mean.values[is.na(dfActNoNA$steps)] 

daily_sum_steps <- dfActNoNA %>%
  mutate(day = as.Date(date, format="%Y-%m-%d")) %>%
  group_by(day) %>% # group by the day column
  summarise(total_steps=sum(steps)) #%>%  # calculate the SUM of all precipitation that occurred on each day
  #na.omit()

hist(daily_sum_steps$total_steps, breaks=10)

#{hist(daily_sum_steps$total_steps, breaks=10)
##abline(v = mx, col = "blue", lwd = 2)
#abline(v=meansteps,col="blue")
#abline(v=mediansteps,col="red")
#}

#barplot(daily_sum_steps$total_steps, names.arg=daily_sum_steps$date)

#dfAct$grp.mean.values
#dfActNoNA <- dfAct
#dfActNoNA[is.na(dfActNoNA)] <- 0
#dfActMeans <- dfActNoNA %>%
#   group_by(dfActNoNA$interval) %>%
#   summarise(yy=mean(dfActNoNA$steps, na.rm = TRUE))
#library(dplyr)
#dfActMeans <- dfActNoNA %>% 
#  group_by(interval) %>% 
#  mutate(steps = is.na(steps), mean(steps, na.rm = TRUE), steps)
#dat2[order(dat2$id), ] #plyr orders by group so we have to reorder
#dfActNoNA <- dfAct


```

The mean and the medium of the total number of steps taken per day:

```{r}
mean(daily_sum_steps$total_steps)

median(daily_sum_steps$total_steps)

```

## Are there differences in activity patterns between weekdays and weekends?

```{r}
dfActNoNA$date <- as.Date(dfActNoNA$date)
weekdays1 <- c('mandag', 'tirsdag', 'onsdag', 'torsdag', 'fredag')
dfActNoNA$wDay <- c('weekend', 'weekday')[(weekdays(dfActNoNA$date) %in% weekdays1)+1L]

library(tidyverse)

#df  <- data.frame(stringsAsFactors=FALSE,
#       country = c("Austia", "Austia", "Austia", "Austia", "Austia", "Austia"),
#   loan_amount = c(175, 100, 825, 175, 1025, 225),
#        gender = c("F", "F", "M", "F", "M", "F")
#)

dfActNoNA %>%
  group_by(wDay)  %>%
  ave(dfAct$steps, dfAct$interval, FUN=function(x) mean(x, na.rm=T))



dfActNoNA$average. <- ave(dfAct$steps, dfAct$interval, FUN=function(x) mean(x, na.rm=T))

dfActNoNA$average.wDay <- ave(dfActNoNA$grp.mean.values, dfActNoNA$wDay, FUN=function(x) mean(x, na.rm=T))

max_x <- dfAct$interval[which.max(dfAct$grp.mean.values)]

ggplot(data = dfAct, aes(x = interval, y = steps)) + 
  stat_summary(fun.y = mean, na.rm = TRUE, geom ='line') +
  geom_hline(yintercept=mean_y, color = "red") +
  geom_vline(xintercept=max_x, color="red") +
  geom_text(aes(0,mean_y,label = round(mean_y,2), vjust = -1)) +
  geom_text(aes(max_x,0,label = round(max_x,2)))


```





#Create a new factor variable in the dataset with two levels – “weekday” and “weekend” indicating whether a given date is a weekday or weekend day.

#Make a panel plot containing a time series plot (i.e.  start color red, type = "l", end color red\color{red}{\verb|type = "l"|}type="l") of the 5-minute #interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). See the README file in the GitHub #repository to see an example of what this plot should look like using simulated data.



